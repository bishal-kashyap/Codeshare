- task: AzureCLI@2
  displayName: "Validate subscription name is unique"
  inputs:
    azureSubscription: $(serviceConnection)
    scriptType: pscore
    scriptLocation: inlineScript
    inlineScript: |
      $ErrorActionPreference = 'Stop'
      $SubscriptionName = "$(subscription_name)"
      # --- paste the script body here OR dot-source from a file ---
      $subs = az account list --all -o json | ConvertFrom-Json
      $match = $subs | Where-Object { ($_.name).Trim() -ieq $SubscriptionName.Trim() }
      if ($match) { Write-Error "Subscription '$SubscriptionName' already exists."; exit 1 } else { Write-Host "OK"; exit 0 }
